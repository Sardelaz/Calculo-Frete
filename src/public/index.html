<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Consulta de Frete Completa</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="container">
        <h1><i class="fas fa-shipping-fast"></i> Consulta de Frete - AZUL CARGO</h1>
        <form id="freteForm">
            <div class="input-group">
                <label for="cep"><i class="fas fa-map-marker-alt"></i> CEP de envio:</label>
                <input type="text" id="cep" name="cep" required placeholder="Ex: 00000-000">
            </div>

            <div class="input-group">
                <label for="peso"><i class="fas fa-balance-scale"></i> Peso (kg):</label>
                <input type="number" id="peso" name="peso" step="0.01" required placeholder="Ex: 1.5">
            </div>

            <div class="input-group">
                <label for="valorPedido"><i class="fas fa-shopping-cart"></i> Valor do pedido (R$):</label>
                <input type="number" id="valorPedido" name="valorPedido" required placeholder="Valor do pedido (R$)" step="0.01">
            </div>

            <button type="submit"><i class="fas fa-search"></i> Consultar</button>
        </form>

        <div class="resultado-wrapper">
            <h2><i class="fas fa-info-circle"></i> Resultado da Consulta:</h2>
            <div id="resultado">
            </div>
        </div>
    </div>
    <script>
        const form = document.getElementById('freteForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const cep = document.getElementById('cep').value;
            const peso = document.getElementById('peso').value;
            // **CORREÇÃO**: Captura o valor do pedido do campo correto
            const valorPedido = document.getElementById('valorPedido').value;

            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.innerHTML = '<p class="loading"><i class="fas fa-spinner fa-spin"></i> Consultando...</p>';

            try {
                const res = await fetch('/consultarTodos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    // **CORREÇÃO**: Envia o valor do pedido no corpo da requisição
                    body: JSON.stringify({ cep, peso, valorPedido })
                });

                const data = await res.json();

                if (data.error) {
                    resultadoDiv.innerHTML = `<p class="error"><i class="fas fa-exclamation-triangle"></i> ${data.error}</p>`;
                    return;
                }

                let html = `
                    <div class="info-header-result">
                        <p><strong>Cidade:</strong> ${data.cidade} | 
                        <strong>UF:</strong> ${data.uf}</p>
                    </div>
                    <div class="frete-cards">
                `;

                data.frete.forEach(f => {
                    html += `
                        <div class="frete-card">
                            <div class="card-item"><strong>Tipo:</strong> <span>${data.tipo}</span></div>
                            <div class="card-item"><strong>Peso:</strong> <span>${peso} kg</span></div>
                            <div class="card-item"><strong>Valor Final do Frete:</strong> <span class="valor-frete">${f.valor}</span></div>
                            <div class="card-item"><strong>Prazo:</strong> <span>${f.prazo} dias <i class="fas fa-clock"></i></span></div>
                        </div>
                    `;
                });

                html += '</div>';
                resultadoDiv.innerHTML = html;

            } catch (error) {
                console.error("Erro na consulta:", error);
                resultadoDiv.innerHTML = `<p class="error"><i class="fas fa-dizzy"></i> Ocorreu um erro inesperado. Verifique o console para mais detalhes.</p>`;
            }
        });
    </script>
</body>

</html>